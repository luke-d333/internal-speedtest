<!DOCTYPE html>
<html>
<head>
  <title>Internal Speedtest</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 0;
      padding-top: 50px;
      min-height: 100vh;
      background: #1A2925;
      color: #EAECE8;
    }

    h1 { color: #ADF5B4; margin-bottom: 10px; }
    p { color: #F2F7FB; margin-bottom: 10px; }

    .form-container {
      display: inline-block;
      text-align: left;
      padding: 1px;
      background: rgba(0, 0, 0, 0.02);
      border-radius: 12px;
    }

    label { display: block; margin-bottom: 5px; color: #C6CFFF; }
    input {
      padding: 8px 12px;
      margin-bottom: 15px;
      border-radius: 8px;
      border: 1px solid #EAECE8;
      width: 305px;
      display: block;
      background-color: #F2F7FB;
      color: #1A2925;
    }

    button {
      padding: 10px 20px;
      border-radius: 8px;
      background: #ADF5B4;
      color: #1A2925;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    button:hover { background: #C6CFFF; }

    .button-row { display: flex; gap: 10px; }

    .results {
      display: none;
      margin-top: 20px;
      padding: 15px;
      border-radius: 12px;
      background: rgba(0, 0, 0, 0.05);
      text-align: center;
    }

    .coverage-text { font-weight: bold; font-size: 1.2em; margin-top: 10px; }
    .poor { color: #EAECE8; }
    .fair { color: #EAECE8; }
    .good { color: #EAECE8; }
    .excellent { color: #EAECE8; }
    
    .text-container {
  max-width: 350px;      /* sets the boundary width */
  margin: 0 auto;         /* centers the container */
  padding: 5px;          /* optional spacing inside */
  text-align: center;     /* keep text centered */
  word-wrap: break-word;  /* ensures long text wraps inside */
}

    
  </style>
</head>
<body>
  <h1>Coverage checker üì∂</h1>
  <div class="text-container">
  <p>Enter your postcode below to check coverage in your area, or click "Use my location" to automatically detect your location</p>
</div>
  <div class="form-container">
    <form id="speedForm">
      <label for="postcode">Full postcode</label>
      <input type="text" id="postcode" name="postcode" required>

      <div class="button-row">
        <button type="submit">Check Coverage üöÄ</button>
        <button type="button" onclick="getLocation()">Use my location üìç</button>
      </div>
    </form>
  </div>

  <div class="results" id="results">
    <h2>Your coverage results üì∂ </h2>
    <div id="coverage" class="coverage-text"></div>
  </div>

  <p id="demo"></p>

  <script>
    const form = document.getElementById('speedForm');
    const resultsDiv = document.getElementById('results');
    const coverageDiv = document.getElementById('coverage');

    // Handle postcode submission
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const data = new FormData(form);

      coverageDiv.innerText = 'Checking coverage...';
      coverageDiv.className = 'coverage-text';
      resultsDiv.style.display = 'block';

      fetch('https://hook.eu2.make.com/8jrfv4ezy9a2lqbrnvaah3sry5od9csw', {
        method: 'POST',
        body: data
      })
      .then(res => res.json())
      .then(result => {
        form.style.display = 'none';
        displayCoverage(result.coverage);
      })
      .catch(err => {
        coverageDiv.innerText = 'Error fetching coverage: ' + err;
        coverageDiv.className = 'coverage-text';
      });
    });

    // Handle geolocation
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(sendCoordinates, showError);
      } else {
        document.getElementById("demo").innerHTML = "Geolocation not supported.";
      }
    }

    function sendCoordinates(position) {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;

      const data = new FormData();
      data.append("latitude", lat);
      data.append("longitude", lon);

      coverageDiv.innerText = 'Checking coverage...';
      coverageDiv.className = 'coverage-text';
      resultsDiv.style.display = 'block';

      fetch('https://hook.eu2.make.com/8jrfv4ezy9a2lqbrnvaah3sry5od9csw', {
        method: 'POST',
        body: data
      })
      .then(res => res.json())
      .then(result => displayCoverage(result.coverage))
      .catch(err => {
        coverageDiv.innerText = 'Error fetching coverage: ' + err;
        coverageDiv.className = 'coverage-text';
      });
    }

    function showError() {
      document.getElementById("demo").innerHTML = "Sorry, location not available.";
    }

    // Reusable coverage display
    function displayCoverage(coverageValue) {
      const coverage = parseInt(coverageValue, 10);
      let coverageText = '';
      let coverageClass = '';

      switch(coverage) {
        case 1: coverageText = 'Poor coverage ü´¢'; coverageClass = 'poor'; break;
        case 2: coverageText = 'Fair coverage üòû'; coverageClass = 'fair'; break;
        case 3: coverageText = 'Good coverage üôÇ'; coverageClass = 'good'; break;
        case 4: coverageText = 'Excellent coverage ü§©'; coverageClass = 'excellent'; break;
        default: coverageText = 'Unknown coverage ü§î'; coverageClass = '';
      }

      coverageDiv.innerText = coverageText;
      coverageDiv.className = 'coverage-text ' + coverageClass;
    }
  </script>

</body>
</html>
